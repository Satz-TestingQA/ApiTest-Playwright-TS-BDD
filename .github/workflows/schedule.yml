name: BookStore-ApiTests-Playwright-TS-BDD

on:
  schedule:
    - cron: '30 2 * * 1-5'  # MON - FRI 8:00 AM IST
  workflow_dispatch:
jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        env: [prod, qa]
    env:
      ENV: ${{ matrix.env }}
    timeout-minutes: 60
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      - name: Verify Node and NPM
        run: |
          node -v
          npm -v
          npm config list
      - name: Install dependencies
        run: npm install
      - name: Install Playwright browsers
        run: npx playwright install
      - name: Run Playwright tests
        run: npm run test
      - name: Generate HTML report with metadata
        run: npm run report
      - name: Zip the report folder
        run: |
          cd reports/extent-report-${{ matrix.env }}
          zip -r ../../extent-report-${{ matrix.env }}.zip .
      - name: Upload zipped report artifact
        uses: actions/upload-artifact@v4
        with:
          name: extent-report-${{ matrix.env }}-zip
          path: extent-report-${{ matrix.env }}.zip
          retention-days: 30

      # - name: Send zipped report via email
      #   uses: dawidd6/action-send-mail@v3
      #   with:
      #     server_address: smtp.gmail.com
      #     server_port: 587
      #     username: satzmails90@gmail.com
      #     password: ${{ secrets.EMAIL_PASSWORD }}
      #     subject: "ðŸ“Š Playwright Test Report - $(date +'%Y-%m-%d')"
      #     to: satztesting1990@gmail.com
      #     from: satzmails90@gmail.com
      #     body: |
      #       Hello,
      #       Please find attached the zipped Playwright test report including charts, screenshots, and videos.

      #       Metadata:
      #       - Browser: Chromium
      #       - Platform: Ubuntu 20.04
      #       - Environment: Production
      #       - Execution Time: $(date +'%T')

      #       Regards,
      #       Playwright Automation Bot
      #     attachments: playwright-report.zip